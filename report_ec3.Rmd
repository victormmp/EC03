---
title: 'Estudo de Caso 3: Planejamento e Análise de Experimentos'
author: "Matheus Marzochi, Mayra Mota, Rafael Ramos e Victor Magalhães"
date: "11 de Novembro de 2019"
output:
  pdf_document:
    fig_caption: yes
  html_document:
    df_print: paged
---

```{r setup,results='hide',warning=FALSE,echo=FALSE, include=FALSE}
# A few initial definitions just to make sure all required packages are installed. Change as needed.
# NOTE: It may echo some weird messages to the PDF on the first compile (package installation messages). Run twice and the problem will (hopefully) go away.

rm(list=ls())

if (!require(ggplot2, quietly = TRUE)){
      install.packages("ggplot2")
      }
if (!require(devtools, quietly = TRUE)){
      install.packages("devtools")
      }
if (!require(broom, quietly = TRUE)){
       devtools::install_github("dgrtwo/broom")
 }

if (!require(ExpDE, quietly = TRUE)){
      install.packages("ExpDE")
}

if (!require(stats, quietly=TRUE)) {
      install.packages("stats")
}

if (!require(boot, quietly=TRUE)) {
      install.packages("boot")
}

if (!require(ggpubr, quietly=TRUE)) {
      install.packages("ggpubr")
}

# knitr::opts_chunk$set(fig.width=6, fig.height=4) 

if (!require(GGally, quietly = TRUE)){
      install.packages("GGally")
}

if (!require(car, quietly = TRUE)){
      install.packages("car")
}

if (!require(samplesize, quietly = TRUE)){
      install.packages("samplesize")
}

if (!require(pwr, quietly = TRUE)){
      install.packages("pwr")
}
if (!require(simpleboot, quietly = TRUE)){
  install.packages("simpleboot")
}
if (!require(dplyr, quietly = TRUE)){
  install.packages("dplyr")
}
if (!require(effsize, quietly = TRUE)){
  install.packages("effsize")
}
if (!require(smoof, quietly = TRUE)) {
  install.packages(smoof)
}
if (!require(pracma, quietly = TRUE)) {
  install.packages(pracma)
}


suppressPackageStartupMessages(library(ExpDE))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(stats))
suppressPackageStartupMessages(library(boot))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(smoof))
suppressPackageStartupMessages(library(pracma))


```
## Resumo

O objetivo deste estudo de caso é investigar como modificações de hiperparâmetros de um algoritmo de otimização baseado em eveolução diferencial influenciam em seu desempenho, em diferentes cenários de execução. Os algoritmose serão testados  partir de funções de Rosenbrook, de dimensões entre 2 e 150. 

## Papéis Desempenhados

A divisão de tarefas no grupo segue a descrição da *Declaração de Políticas de Equipe*. Estando aqui organizada da seguinte forma:

 - Matheus: Verificador
 - Mayra: Monitora
 - Rafael: Coordenador
 - Victor: Revisor

## Planejamento do Experimento


### Métricas 

$$
\begin{cases}
  H_0: \mu_{2016/2} - \mu_{2017/2} = 0 \\
  H_1: \mu_{2016/2} - \mu_{2017/2} \neq 0
\end{cases}
$$

### Execução do Experimento

Como deseja-se avaliar o desempenho das duas configurações de algoritmos sob diferentes dimensões de problema, serão realizados testes pareados. Cada observação do teste corresponde a uma dimensão do problema de Rosenbrook. Considerando as métricas para o teste estabelecidas anteriormente, o número de instâncias para o teste pareado deverá ser, no  mínimo, 34 amostras, como o cálculo a seguir demonstra.

```{r num_amostras, echo=TRUE}
result <- power.t.test(delta=0.5,
             sig.level=0.05,
             power=0.8,
             type='paired',
             alternative='two.sided')
print(result)
```



## Coleta dos Dados

```{r coleta_dados, echo=TRUE, eval=FALSE}
n_instancias <- 34

dimensions <- linspace(2, 150, n_instancias)

out_dim.conf1 = data.frame(matrix(ncol = 2, nrow = 0))
colnames(out_dim.conf1) <- c("dim", "best")
out_dim.conf2 = data.frame(matrix(ncol = 2, nrow = 0))
colnames(out_dim.conf2) <- c("dim", "best")

count.dim <- 1
for (d in dimensions){

    dim <- ceil(d)

    cat("\nBuilding dimension ", dim)

    fn <- function(X){
        if(!is.matrix(X)) X <- matrix(X, nrow = 1) # <- if a single vector is passed as X
        Y <- apply(X, MARGIN = 1,
                   FUN = smoof::makeRosenbrockFunction(dimensions = dim))
        return(Y)
    }
    selpars <- list(name = "selection_standard")
    stopcrit <- list(names = "stop_maxeval", maxevals = 5000 * dim, maxiter = 100 * dim)
    probpars <- list(name = "fn", xmin = rep(-5, dim), xmax = rep(10, dim))
    popsize = 5 * dim

    ## Config 1
    recpars1 <- list(name = "recombination_arith")
    mutpars1 <- list(name = "mutation_rand", f = 4)
    ## Config 2
    recpars2 <- list(name = "recombination_bin", cr = 0.7)
    mutpars2 <- list(name = "mutation_best", f = 3)

    out <- ExpDE(mutpars = mutpars1,
                 recpars = recpars1,
                 popsize = popsize,
                 selpars = selpars,
                 stopcrit = stopcrit,
                 probpars = probpars,
                 showpars = list(show.iters = "dots", showevery = 20))
    de <- list("dim"=dim, "best"=out$Fbest)
    out_dim.conf1 <- rbind(out_dim.conf1,de, stringsAsFactors=FALSE)

    out <- ExpDE(mutpars = mutpars2,
                 recpars = recpars2,
                 popsize = popsize,
                 selpars = selpars,
                 stopcrit = stopcrit,
                 probpars = probpars,
                 showpars = list(show.iters = "dots", showevery = 20))
    de <- list("dim"=dim, "best"=out$Fbest)
    out_dim.conf2 <- rbind(out_dim.conf1,de, stringsAsFactors=FALSE)

    count.dim <- count.dim + 1
}
}
```




## Análise Exploratória dos Dados



### Análise dos Dados Experimentais Femininos

#### Teste de Hipótese

### Discussão para Melhoria do Experimento 


## Conclusões


## Referências

---
references:
- id: NyTimes
  title: How Often Is B.M.I. Misleading? 
  URL: https://www.nytimes.com/interactive/projects/cp/summer-of-science-2015/latest/how-often-is-bmi-misleading
  issued:
    year: 2015
    
- id: Science
  title: The Health Risk of Obesity—Better Metrics Imperative
  URL: https://science.sciencemag.org/content/341/6148/856.summary
  issued:
    year: 2013
  
- id: Montgomery2012
  title: Estatística Aplicada e Probabilidade para Engenheiros
  author:
  - family: Montgomery
    given: Douglas
  - family: Runger
    given: George
  publisher: LTC
  type: book
  issued:
    year: 2012
    
- id: Ministerio
  title: IMC em Adultos
  author:
  - family: Ministério da Saúde
    given: 
  URL: 'http://portalms.saude.gov.br/component/content/article/804-imc/40509-imc-em-adultos'
  issued:
    year: 2017
---
